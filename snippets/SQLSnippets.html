<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL | Code-snippets</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="A place to store code snippets">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/code-snippets/assets/css/0.styles.59d3788c.css" as="style"><link rel="preload" href="/code-snippets/assets/js/app.723004a5.js" as="script"><link rel="preload" href="/code-snippets/assets/js/2.602e7805.js" as="script"><link rel="preload" href="/code-snippets/assets/js/14.d4efdd0d.js" as="script"><link rel="prefetch" href="/code-snippets/assets/js/10.b0400252.js"><link rel="prefetch" href="/code-snippets/assets/js/11.b53bb780.js"><link rel="prefetch" href="/code-snippets/assets/js/12.01a03e36.js"><link rel="prefetch" href="/code-snippets/assets/js/13.f649cb48.js"><link rel="prefetch" href="/code-snippets/assets/js/15.2014ec09.js"><link rel="prefetch" href="/code-snippets/assets/js/16.4e3b565b.js"><link rel="prefetch" href="/code-snippets/assets/js/17.be7b01dc.js"><link rel="prefetch" href="/code-snippets/assets/js/18.bb3dd552.js"><link rel="prefetch" href="/code-snippets/assets/js/19.17b3090a.js"><link rel="prefetch" href="/code-snippets/assets/js/3.f7a4b7da.js"><link rel="prefetch" href="/code-snippets/assets/js/4.daa1b9c6.js"><link rel="prefetch" href="/code-snippets/assets/js/5.6fc606de.js"><link rel="prefetch" href="/code-snippets/assets/js/6.8a9e12b1.js"><link rel="prefetch" href="/code-snippets/assets/js/7.412f5d2e.js"><link rel="prefetch" href="/code-snippets/assets/js/8.ec32e405.js"><link rel="prefetch" href="/code-snippets/assets/js/9.1fac9f2d.js">
    <link rel="stylesheet" href="/code-snippets/assets/css/0.styles.59d3788c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/code-snippets/" class="home-link router-link-active"><!----> <span class="site-name">Code-snippets</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/code-snippets/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/code-snippets/snippets/" class="nav-link router-link-active">
  Snippets
</a></div><div class="nav-item"><a href="/code-snippets/documents/" class="nav-link">
  Documents
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/code-snippets/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/code-snippets/snippets/" class="nav-link router-link-active">
  Snippets
</a></div><div class="nav-item"><a href="/code-snippets/documents/" class="nav-link">
  Documents
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/code-snippets/snippets/" aria-current="page" class="sidebar-link">Code Snippets Home</a></li><li><a href="/code-snippets/snippets/vuepressSnippets.html" class="sidebar-link">Vuepress</a></li><li><a href="/code-snippets/snippets/dotNetSnippets.html" class="sidebar-link">.Net</a></li><li><a href="/code-snippets/snippets/SQLSnippets.html" aria-current="page" class="active sidebar-link">SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#query-order" class="sidebar-link">Query Order</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#table-creation-and-setting-keys" class="sidebar-link">Table Creation and Setting Keys</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#creating-a-table" class="sidebar-link">Creating a Table</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#dropping-a-table" class="sidebar-link">Dropping a table</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#creating-an-integer-primary-key" class="sidebar-link">Creating an Integer Primary Key</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#creating-a-guid-primary-key" class="sidebar-link">Creating a Guid Primary Key</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#auto-incrementing-primary-keys" class="sidebar-link">Auto-Incrementing Primary Keys</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#composite-keys-use-of-more-than-one-field-as-primary-key" class="sidebar-link">Composite Keys - use of more than one field as primary key</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#columns-and-constraints" class="sidebar-link">Columns and Constraints</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#defining-columns" class="sidebar-link">Defining Columns</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#basic-column-constraints" class="sidebar-link">Basic Column Constraints</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#column-defaults" class="sidebar-link">Column Defaults</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#inserting-updating-and-deleting-data" class="sidebar-link">Inserting, Updating and Deleting Data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#inserting-data" class="sidebar-link">Inserting Data</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#bulk-inserts" class="sidebar-link">Bulk Inserts</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#updates" class="sidebar-link">Updates</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#bulk-updates" class="sidebar-link">Bulk Updates</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#deleting-data" class="sidebar-link">Deleting Data</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#bulk-delete" class="sidebar-link">Bulk Delete</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#selects-aliases-and-joins" class="sidebar-link">Selects, Aliases and Joins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#select" class="sidebar-link">Select</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#aliasing-columns" class="sidebar-link">Aliasing Columns</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#column-expressions" class="sidebar-link">Column Expressions</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#inner-joins" class="sidebar-link">Inner Joins</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#left-joins" class="sidebar-link">Left Joins</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#right-joins" class="sidebar-link">Right Joins</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#full-joins" class="sidebar-link">Full Joins</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#ordering-and-filtering-results" class="sidebar-link">Ordering and Filtering Results</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#ordering-results" class="sidebar-link">Ordering Results</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#limiting-results" class="sidebar-link">Limiting Results</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#sequential-ordering" class="sidebar-link">Sequential Ordering</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#filtering-by-sets" class="sidebar-link">Filtering By Sets</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#offsetting" class="sidebar-link">Offsetting</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#aggregates-and-grouping" class="sidebar-link">Aggregates and Grouping</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#basic-aggregates" class="sidebar-link">Basic Aggregates</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#grouping-results" class="sidebar-link">Grouping Results</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#filtering-aggregate-results" class="sidebar-link">Filtering Aggregate Results</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#setting-many-to-many-constraints" class="sidebar-link">Setting Many to Many Constraints</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#many-to-many-table-constraints" class="sidebar-link">Many to Many Table Constraints</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#self-referencing-tables" class="sidebar-link">Self Referencing Tables</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#querying-a-self-referencing-table-subquery" class="sidebar-link">Querying a Self-Referencing Table (Subquery)</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#querying-a-self-referencing-table-using-a-join" class="sidebar-link">Querying a Self-Referencing Table Using a Join</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#working-with-strings-fixing-bad-data" class="sidebar-link">Working with Strings / Fixing Bad Data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#query-strings-with-partial-matching" class="sidebar-link">Query Strings with Partial Matching</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#partial-string-results-with-substrings" class="sidebar-link">Partial String Results with Substrings</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#editing-strings-with-replace" class="sidebar-link">Editing Strings with Replace</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#fix-bad-data-with-trim" class="sidebar-link">Fix Bad Data with Trim</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#fix-bad-data-with-rtrim-and-datalength" class="sidebar-link">Fix Bad Data with RTrim and Datalength</a></li></ul></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#working-with-dates" class="sidebar-link">Working with Dates</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#slicing-dates-with-datepart" class="sidebar-link">Slicing Dates with Datepart</a></li><li class="sidebar-sub-header"><a href="/code-snippets/snippets/SQLSnippets.html#doing-math-with-datediff" class="sidebar-link">Doing Math with Datediff</a></li></ul></li></ul></li><li><a href="/code-snippets/snippets/vueSnippets.html" class="sidebar-link">Vue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sql-snippets"><a href="#sql-snippets" class="header-anchor">#</a> SQL Snippets</h1> <p>These are SQL Snippets</p> <h2 id="query-order"><a href="#query-order" class="header-anchor">#</a> Query Order</h2> <ul><li>Select</li> <li>From</li> <li>Where</li> <li>Groupby</li> <li>Having</li> <li>Orderby</li> <li>Offset</li></ul> <h2 id="table-creation-and-setting-keys"><a href="#table-creation-and-setting-keys" class="header-anchor">#</a> Table Creation and Setting Keys</h2> <h3 id="creating-a-table"><a href="#creating-a-table" class="header-anchor">#</a> Creating a Table</h3> <p>From inside SSMS right click on databases select new database and create one.</p> <p>Select the database and click new query.</p> <p>In the query window enter:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This creates a table called users with one column email that is of type varchar (variable character field) with a max length of 50 characters.</p> <p>Refresh the object explorer after running a query for the changes to show up.</p> <h3 id="dropping-a-table"><a href="#dropping-a-table" class="header-anchor">#</a> Dropping a table</h3> <p>To delete a table (drop it) run a new query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> Users<span class="token punctuation">;</span>
</code></pre></div><p>This will remove the table from the database.</p> <h3 id="creating-an-integer-primary-key"><a href="#creating-an-integer-primary-key" class="header-anchor">#</a> Creating an Integer Primary Key</h3> <p>Run a new query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now the first column Id is an integer and is also used as the primary key no duplicate integers will be allowed in this field they must be unique.</p> <h3 id="creating-a-guid-primary-key"><a href="#creating-a-guid-primary-key" class="header-anchor">#</a> Creating a Guid Primary Key</h3> <p>Used to have unique Id’s to enable easier data access outside of SMSS.</p> <p>Run a new query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id uniqueidentifier <span class="token keyword">primary</span> <span class="token keyword">key</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The table users is created with one column that is a primary key of type Guid.</p> <h3 id="auto-incrementing-primary-keys"><a href="#auto-incrementing-primary-keys" class="header-anchor">#</a> Auto-Incrementing Primary Keys</h3> <p><strong>Using integers.</strong></p> <p>Run a query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The table has an integer primary key. As data is added to the email column
the Id column will auto populate starting at 1 the second 1 in the parameter means that the Id will then increment by one when each row is populated.</p> <p><strong>Using Guids.</strong></p> <p>Run a query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id uniqueidentifier <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">default</span> newid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After editing the table data will show null. Right click in the edit pane and click Execute SQL this will refresh the view and the Id’s will show up.</p> <h3 id="composite-keys-use-of-more-than-one-field-as-primary-key"><a href="#composite-keys-use-of-more-than-one-field-as-primary-key" class="header-anchor">#</a> Composite Keys - use of more than one field as primary key</h3> <p>Using an intermediate table for a one to many relationship.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> Users_Roles<span class="token punctuation">(</span>
	UserId <span class="token keyword">integer</span><span class="token punctuation">,</span>
	RoleId <span class="token keyword">integer</span><span class="token punctuation">,</span>
	<span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>UserId<span class="token punctuation">,</span>RoleId<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> Roles<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This sets the UserId and the RoleId as a composite primary key in the Users_Roles table this ensures that the user can only be assigned a role once as the 2 properties are being checked to make sure they are a unique combination.</p> <h2 id="columns-and-constraints"><a href="#columns-and-constraints" class="header-anchor">#</a> Columns and Constraints</h2> <h3 id="defining-columns"><a href="#defining-columns" class="header-anchor">#</a> Defining Columns</h3> <p>Use a comma delimited list to set columns.</p> <p>Run a query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	CreatedAt <span class="token keyword">datetime</span><span class="token punctuation">,</span>
	<span class="token keyword">First</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">Last</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Bio <span class="token keyword">varchar</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This creates 6 columns with the headings Id, Email, CreatedAt, First, Last and Bio (set to max value of varchar) Text could also be used.</p> <h3 id="basic-column-constraints"><a href="#basic-column-constraints" class="header-anchor">#</a> Basic Column Constraints</h3> <ul><li>not null - used to make a field require a value.</li> <li>unique - used to make the field need to be a unique value.</li> <li>decimal(10,2) - used to limit the decimal number to 10 numbers with 2 decimal places.</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>
	CreatedAt <span class="token keyword">datetime</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	<span class="token keyword">First</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">Last</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Bio <span class="token keyword">text</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="column-defaults"><a href="#column-defaults" class="header-anchor">#</a> Column Defaults</h3> <p>Default - keyword can be used to set the default behavior of the field.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MoneySpent <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
CreatedAt <span class="token keyword">datetime</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>These parameters set the MoneySpent field to default to 0 and the CreatedAt field to default to the current date and time.</p> <h2 id="inserting-updating-and-deleting-data"><a href="#inserting-updating-and-deleting-data" class="header-anchor">#</a> Inserting, Updating and Deleting Data</h2> <h3 id="inserting-data"><a href="#inserting-data" class="header-anchor">#</a> Inserting Data</h3> <p>Use the insert keyword.</p> <p>Run a query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> Users<span class="token punctuation">(</span>Email<span class="token punctuation">,</span> CreatedAt<span class="token punctuation">,</span> <span class="token keyword">First</span><span class="token punctuation">,</span> <span class="token keyword">Last</span><span class="token punctuation">,</span> Bio<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'test2@test.com'</span><span class="token punctuation">,</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'some person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Multiple values can be wrapped in parentheses and inserted into the table.</p> <h3 id="bulk-inserts"><a href="#bulk-inserts" class="header-anchor">#</a> Bulk Inserts</h3> <p>Use to insert multiple fields from a data source.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> Users<span class="token punctuation">(</span>Email<span class="token punctuation">,</span> <span class="token keyword">First</span><span class="token punctuation">,</span> <span class="token keyword">Last</span><span class="token punctuation">)</span>
<span class="token keyword">select</span> Email<span class="token punctuation">,</span> FirstName<span class="token punctuation">,</span> LastName
<span class="token keyword">from</span> Chinook<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>Customer
</code></pre></div><p>The above query inserts all the select fields from the Chinook.dbo.Customer table into the Users table in the corresponding parameter fields.
<br>This is a good way to bulk insert data from another table.</p> <h3 id="updates"><a href="#updates" class="header-anchor">#</a> Updates</h3> <p>Use update statements to update data in the table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Users <span class="token keyword">set</span>
CreatedAt <span class="token operator">=</span> <span class="token string">'09/23/2014'</span>
<span class="token keyword">where</span> Id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>This query updates the created at field in the users table where the row contains the Id of 1.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Users <span class="token keyword">set</span>
CreatedAt <span class="token operator">=</span> <span class="token string">'09/23/2013'</span>
<span class="token keyword">where</span> Email <span class="token operator">=</span> <span class="token string">'luisg@embraer.com.br'</span><span class="token punctuation">;</span>
</code></pre></div><p>If the primary key is not known another field can be used in the where statement to identify the row.</p> <h3 id="bulk-updates"><a href="#bulk-updates" class="header-anchor">#</a> Bulk Updates</h3> <p>Where statements can be used to update multiple results that match the criteria.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Users <span class="token keyword">set</span>
CreatedAt <span class="token operator">=</span> <span class="token string">'09/23/2013'</span> 
<span class="token keyword">where</span> Id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><p>This query updates the first 10 users CreatedAt field.</p> <h3 id="deleting-data"><a href="#deleting-data" class="header-anchor">#</a> Deleting Data</h3> <p>Use a delete statement to remove data from the table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> Users
<span class="token keyword">where</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="bulk-delete"><a href="#bulk-delete" class="header-anchor">#</a> Bulk Delete</h3> <p>Use a where statement to select multiple rows for deletion.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> Users 
<span class="token keyword">where</span> Id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><p>Deletes all rows from Users table where the user Id is 10 or less.</p> <p>Use a delete statement with no criteria to delete all data in the table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> Users<span class="token punctuation">;</span>
</code></pre></div><p>Deletes all rows from the Users table.</p> <h2 id="selects-aliases-and-joins"><a href="#selects-aliases-and-joins" class="header-anchor">#</a> Selects, Aliases and Joins</h2> <h3 id="select"><a href="#select" class="header-anchor">#</a> Select</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> TableName<span class="token punctuation">;</span>
</code></pre></div><p>selects all rows from a table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span>  FirstName<span class="token punctuation">,</span> LastName<span class="token punctuation">,</span> Email <span class="token keyword">from</span> Customer<span class="token punctuation">;</span>  
</code></pre></div><p>selects the three columns listed from the customer table.</p> <h3 id="aliasing-columns"><a href="#aliasing-columns" class="header-anchor">#</a> Aliasing Columns</h3> <p>To change the names of column headings the as keyword can be used.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> firstName <span class="token keyword">as</span> <span class="token keyword">First</span><span class="token punctuation">,</span>
lastName <span class="token keyword">as</span> <span class="token keyword">Last</span>
<span class="token keyword">from</span> Customer<span class="token punctuation">;</span>
</code></pre></div><p>Displays two columns First and Last with the data from firstName, lastName. Quotation can be used to add spaces in headings ‘First Name’ e.t.c.</p> <h3 id="column-expressions"><a href="#column-expressions" class="header-anchor">#</a> Column Expressions</h3> <p>To concatenate strings the ‘+’ operator can be used.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName <span class="token keyword">as</span> <span class="token string">'Customer Name'</span><span class="token punctuation">,</span>
Email<span class="token punctuation">,</span> Country
<span class="token keyword">from</span> Customer<span class="token punctuation">;</span>
</code></pre></div><h3 id="inner-joins"><a href="#inner-joins" class="header-anchor">#</a> Inner Joins</h3> <p>Used to join 2 tables with a common field.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Invoice<span class="token punctuation">.</span>InvoiceId<span class="token punctuation">,</span>InvoiceDate<span class="token punctuation">,</span> UnitPrice<span class="token punctuation">,</span> Quantity
<span class="token keyword">from</span> Invoice
<span class="token keyword">inner</span> <span class="token keyword">join</span> InvoiceLine
<span class="token keyword">on</span> InvoiceLine<span class="token punctuation">.</span>InvoiceId <span class="token operator">=</span> Invoice<span class="token punctuation">.</span>InvoiceId
</code></pre></div><p>In this query the rows from the InvoiceLine table are joined to the Invoice table using the InvoiceId as a common field. This makes all the data from the tables accessible using the InvoiceId as a key for the rows.</p> <h3 id="left-joins"><a href="#left-joins" class="header-anchor">#</a> Left Joins</h3> <p>Used to show all rows from the left most table with the property in the query even if the joining field is not in the right hand table null is displayed where the data is not present.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Name<span class="token punctuation">,</span> Title
<span class="token keyword">from</span> Artist <span class="token keyword">left</span> <span class="token keyword">join</span> Album
<span class="token keyword">on</span> Album<span class="token punctuation">.</span>ArtistId <span class="token operator">=</span> Artist<span class="token punctuation">.</span>ArtistId<span class="token punctuation">;</span>
</code></pre></div><p>In the above query all the rows from the Artist table are included as this is the table on the left. All the Id’s and names are displayed. Where the Album table has a corresponding ArtistId the Title of the album is shown. If an artist has no album in the table the title column is null.</p> <h3 id="right-joins"><a href="#right-joins" class="header-anchor">#</a> Right Joins</h3> <p>The opposite of a left join.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Name<span class="token punctuation">,</span> Title
<span class="token keyword">from</span> Artist <span class="token keyword">right</span> <span class="token keyword">join</span> Album
<span class="token keyword">on</span> Album<span class="token punctuation">.</span>ArtistId <span class="token operator">=</span> Artist<span class="token punctuation">.</span>ArtistId<span class="token punctuation">;</span>
</code></pre></div><p>All the artistId and title will display from the album table if the corresponding artist name is not in the artist table then null will be shown for the name.</p> <h3 id="full-joins"><a href="#full-joins" class="header-anchor">#</a> Full Joins</h3> <p>Equivalent of a left right join. All matching data is displayed from both tables and if a field does not correspond null is shown. This is a good way to check if the tables contain the correct Id’s e.t.c.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Name<span class="token punctuation">,</span> Title
<span class="token keyword">from</span> Artist <span class="token keyword">full</span> <span class="token keyword">join</span> Album
<span class="token keyword">on</span> Album<span class="token punctuation">.</span>ArtistId <span class="token operator">=</span> Artist<span class="token punctuation">.</span>ArtistId<span class="token punctuation">;</span>
</code></pre></div><h2 id="ordering-and-filtering-results"><a href="#ordering-and-filtering-results" class="header-anchor">#</a> Ordering and Filtering Results</h2> <h3 id="ordering-results"><a href="#ordering-results" class="header-anchor">#</a> Ordering Results</h3> <p>Order by is used to order the query results if the desc keyword is used the query results are shown in descending order.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName <span class="token keyword">as</span> Name<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> Country<span class="token punctuation">,</span>
InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total
<span class="token keyword">from</span> Customer
<span class="token keyword">inner</span> <span class="token keyword">join</span> Invoice <span class="token keyword">on</span> Invoice<span class="token punctuation">.</span>CustomerId <span class="token operator">=</span> Customer<span class="token punctuation">.</span>CustomerId
<span class="token keyword">where</span> Country <span class="token operator">=</span> <span class="token string">'Brazil'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> Total <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre></div><p>The above query finds the customer with the biggest invoice total in Brazil ordered by descending total.</p> <h3 id="limiting-results"><a href="#limiting-results" class="header-anchor">#</a> Limiting Results</h3> <p>Use select top (number) to fetch the top (number) matches to a query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">10</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName <span class="token keyword">as</span> Name<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> Country<span class="token punctuation">,</span>
InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total
<span class="token keyword">from</span> Customer
<span class="token keyword">inner</span> <span class="token keyword">join</span> Invoice <span class="token keyword">on</span> Invoice<span class="token punctuation">.</span>CustomerId <span class="token operator">=</span> Customer<span class="token punctuation">.</span>CustomerId
<span class="token keyword">where</span> Country <span class="token operator">=</span> <span class="token string">'Brazil'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> Total <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sequential-ordering"><a href="#sequential-ordering" class="header-anchor">#</a> Sequential Ordering</h3> <p>The order by statement can take multiple fields to shape the order of the data displayed.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName <span class="token keyword">as</span> Name<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> Country<span class="token punctuation">,</span>
InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total
<span class="token keyword">from</span> Customer
<span class="token keyword">inner</span> <span class="token keyword">join</span> Invoice <span class="token keyword">on</span> Invoice<span class="token punctuation">.</span>CustomerId <span class="token operator">=</span> Customer<span class="token punctuation">.</span>CustomerId
<span class="token keyword">where</span> Country <span class="token operator">=</span> <span class="token string">'USA'</span>
<span class="token operator">or</span> Country <span class="token operator">=</span> <span class="token string">'Canada'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> Country<span class="token punctuation">,</span> LastName<span class="token punctuation">;</span>
</code></pre></div><p>Note that in the above query even though LastName is not displayed in the select statement the field can still be used in the order by operation.</p> <h3 id="filtering-by-sets"><a href="#filtering-by-sets" class="header-anchor">#</a> Filtering By Sets</h3> <p>Use IN and - to filter query results. The NOT IN operator can be used to exclude rows from the results.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName <span class="token keyword">as</span> Name<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> Country<span class="token punctuation">,</span>
InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total
<span class="token keyword">from</span> Customer
<span class="token keyword">inner</span> <span class="token keyword">join</span> Invoice <span class="token keyword">on</span> Invoice<span class="token punctuation">.</span>CustomerId <span class="token operator">=</span> Customer<span class="token punctuation">.</span>CustomerId
<span class="token keyword">where</span> Country <span class="token operator">IN</span><span class="token punctuation">(</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> ‘Canada’<span class="token punctuation">,</span> ‘Argentina’<span class="token punctuation">)</span>
<span class="token operator">and</span> Total <span class="token operator">&gt;</span> <span class="token number">5</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> Country <span class="token keyword">desc</span><span class="token punctuation">,</span> LastName<span class="token punctuation">;</span>
</code></pre></div><p>The query is filtered first by country then the total sales must be more than 5 then ordered by Country descending then LastName ascending.</p> <h3 id="offsetting"><a href="#offsetting" class="header-anchor">#</a> Offsetting</h3> <p>Offsetting can be used to remove rows from the query results. The results must first have an order by statement before the rows can be offset the number of rows specified to offset are removed from the top of the displayed results.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName <span class="token keyword">as</span> Name<span class="token punctuation">,</span> Email<span class="token punctuation">,</span> Country<span class="token punctuation">,</span>
InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total
<span class="token keyword">from</span> Customer
<span class="token keyword">inner</span> <span class="token keyword">join</span> Invoice <span class="token keyword">on</span> Invoice<span class="token punctuation">.</span>CustomerId <span class="token operator">=</span> Customer<span class="token punctuation">.</span>CustomerId
<span class="token keyword">where</span> Country <span class="token operator">=</span> <span class="token string">'USA'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> Total <span class="token keyword">desc</span>
<span class="token keyword">offset</span> <span class="token number">1</span> <span class="token keyword">rows</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="aggregates-and-grouping"><a href="#aggregates-and-grouping" class="header-anchor">#</a> Aggregates and Grouping</h2> <h3 id="basic-aggregates"><a href="#basic-aggregates" class="header-anchor">#</a> Basic Aggregates</h3> <ul><li>SUM - Total of column</li> <li>AVG - Mean average of column.</li> <li>COUNT - Total rows in column</li> <li>MIN - Smallest value in column</li> <li>MAX - Largest value in column</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> 
<span class="token function">SUM</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> AllTimeSales<span class="token punctuation">,</span>
<span class="token function">AVG</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> AvgSale<span class="token punctuation">,</span>
<span class="token function">COUNT</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> SalesCount<span class="token punctuation">,</span>
<span class="token function">MIN</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> SmallestSale<span class="token punctuation">,</span>
<span class="token function">MAX</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> BiggestSale
<span class="token keyword">from</span> Invoice<span class="token punctuation">;</span>
</code></pre></div><h3 id="grouping-results"><a href="#grouping-results" class="header-anchor">#</a> Grouping Results</h3> <p>When selecting a field when aggregating results the query must have a group by statement to tell the query how to use the data in the field.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> BillingCountry<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span>Total<span class="token punctuation">)</span> <span class="token keyword">as</span> AllTimeSales
<span class="token keyword">from</span> Invoice
<span class="token keyword">Group</span> <span class="token keyword">by</span> BillingCountry
</code></pre></div><h3 id="filtering-aggregate-results"><a href="#filtering-aggregate-results" class="header-anchor">#</a> Filtering Aggregate Results</h3> <p>When filtering aggregate results the AND keyword is not used instead use the HAVING keyword.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> BillingCountry<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span>UnitPrice <span class="token operator">*</span> Quantity<span class="token punctuation">)</span> <span class="token keyword">as</span> SalesTotal
<span class="token keyword">from</span> Invoice
<span class="token keyword">inner</span> <span class="token keyword">join</span> InvoiceLine <span class="token keyword">on</span> InvoiceLine<span class="token punctuation">.</span>InvoiceId <span class="token operator">=</span> Invoice<span class="token punctuation">.</span>InvoiceId
<span class="token keyword">Where</span> BillingCountry <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'Germany'</span><span class="token punctuation">,</span> <span class="token string">'Argentina'</span><span class="token punctuation">,</span> <span class="token string">'United Kingdom'</span><span class="token punctuation">)</span>
<span class="token keyword">Group</span> <span class="token keyword">by</span> BillingCountry
<span class="token keyword">Having</span> <span class="token function">SUM</span><span class="token punctuation">(</span>UnitPrice <span class="token operator">*</span> Quantity<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">40</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> BillingCountry
</code></pre></div><h2 id="setting-many-to-many-constraints"><a href="#setting-many-to-many-constraints" class="header-anchor">#</a> Setting Many to Many Constraints</h2> <h3 id="many-to-many-table-constraints"><a href="#many-to-many-table-constraints" class="header-anchor">#</a> Many to Many Table Constraints</h3> <p>When setting up many to many relationships with an intermediate table the intermediate table can be set to not allow invalid data to be inserted. To do this use foreign keys by referencing other table keys.<br>
To avoid the problem of orphaned data a cascading delete can be set up on the intermediate table also.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Users<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	Email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> Role<span class="token punctuation">(</span>
	Id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
	Name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> UserRole<span class="token punctuation">(</span>
UserId <span class="token keyword">integer</span> <span class="token keyword">references</span> Users<span class="token punctuation">(</span>Id<span class="token punctuation">)</span> <span class="token keyword">on</span> <span class="token keyword">delete</span> <span class="token keyword">cascade</span><span class="token punctuation">,</span>
	RoleId <span class="token keyword">integer</span> <span class="token keyword">references</span> Role<span class="token punctuation">(</span>Id<span class="token punctuation">)</span><span class="token keyword">on</span> <span class="token keyword">delete</span> <span class="token keyword">cascade</span><span class="token punctuation">,</span>
	<span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>UserId<span class="token punctuation">,</span> RoleId<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The order of the table creation is important the referenced tables need to be created before the referencing table.</p> <h2 id="self-referencing-tables"><a href="#self-referencing-tables" class="header-anchor">#</a> Self Referencing Tables</h2> <h3 id="querying-a-self-referencing-table-subquery"><a href="#querying-a-self-referencing-table-subquery" class="header-anchor">#</a> Querying a Self-Referencing Table (Subquery)</h3> <p>Can be done with a nested select (Subquery)</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> FirstName<span class="token punctuation">,</span> LastName<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> LastName 
		<span class="token keyword">from</span> Employee bosses 
		<span class="token keyword">where</span> Employee<span class="token punctuation">.</span>ReportsTo <span class="token operator">=</span> bosses<span class="token punctuation">.</span>EmployeeId<span class="token punctuation">)</span><span class="token keyword">as</span> boss
<span class="token keyword">from</span> Employee<span class="token punctuation">;</span>
</code></pre></div><p>In the above query the same table is referenced in the subquery. To make this query successful an alias must be used in this case ‘bosses’ this enables us to query the table twice to find the employee ReportsTo field that is equal to the EmployeeId field in the same table.</p> <h3 id="querying-a-self-referencing-table-using-a-join"><a href="#querying-a-self-referencing-table-using-a-join" class="header-anchor">#</a> Querying a Self-Referencing Table Using a Join</h3> <p>To avoid using a subquery a join can be used.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> workers<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span> workers<span class="token punctuation">.</span>LastName<span class="token punctuation">,</span>
bosses<span class="token punctuation">.</span>FirstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> bosses<span class="token punctuation">.</span>LastName <span class="token keyword">as</span> boss
<span class="token keyword">from</span> Employee workers
<span class="token keyword">left</span> <span class="token keyword">join</span> Employee <span class="token keyword">as</span> bosses
<span class="token keyword">On</span> workers<span class="token punctuation">.</span>ReportsTo <span class="token operator">=</span> bosses<span class="token punctuation">.</span>EmployeeId
</code></pre></div><p>The above query is the equivalent of the subquery version again note that both queries of the same table have to use an alias to remove ambiguity.</p> <h2 id="working-with-strings-fixing-bad-data"><a href="#working-with-strings-fixing-bad-data" class="header-anchor">#</a> Working with Strings / Fixing Bad Data</h2> <h3 id="query-strings-with-partial-matching"><a href="#query-strings-with-partial-matching" class="header-anchor">#</a> Query Strings with Partial Matching</h3> <p>To query strings with a partial match the like keyword is used with % to fill in as a wildcard.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> Artist 
<span class="token keyword">where</span> Name <span class="token operator">LIKE</span> <span class="token string">'AC/DC%'</span>
</code></pre></div><p>The above query will be successful but is an expensive operation as the select will index on every record using the primary key then match the data to the query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> Artist 
<span class="token keyword">where</span> Name <span class="token operator">LIKE</span> <span class="token string">'AC/DC%'</span>

<span class="token keyword">create</span> <span class="token keyword">index</span> idx_artist_name <span class="token keyword">on</span> Artist<span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To avoid this an index can be created on the property that will have the query run against it. This will speed up the query as it will run against the index first before fetching the relevant data.
Be aware the indexer cannot optimise for terms that start with a wildcard or that use a function call in the where statement.</p> <h3 id="partial-string-results-with-substrings"><a href="#partial-string-results-with-substrings" class="header-anchor">#</a> Partial String Results with Substrings</h3> <p>Substrings can be used to select a portion of the string data in a field.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Name<span class="token punctuation">,</span> SUBSTRING<span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span>
<span class="token keyword">from</span> Artist<span class="token punctuation">;</span>
</code></pre></div><p>Use cases for this could be excerpts for a blog post summary concatenate ‘...Read More’ e.t.c
Also can be used to resize a varchar field if all the data is always below a certain size take all the fields as substrings and put them into an appropriately sized field.</p> <h3 id="editing-strings-with-replace"><a href="#editing-strings-with-replace" class="header-anchor">#</a> Editing Strings with Replace</h3> <p>The replace keyword can be used to replace data in a field before it is displayed.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">REPLACE</span> <span class="token punctuation">(</span>Title<span class="token punctuation">,</span> <span class="token string">'Blood'</span><span class="token punctuation">,</span> <span class="token string">'B*****d'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CleanTitle
<span class="token keyword">from</span> Album <span class="token keyword">where</span> Title <span class="token operator">LIKE</span> <span class="token string">'%Blood%'</span><span class="token punctuation">;</span>
</code></pre></div><p>The word blood is replaced by B****d and the resulting string is displayed in the CleanTitle column.</p> <h3 id="fix-bad-data-with-trim"><a href="#fix-bad-data-with-trim" class="header-anchor">#</a> Fix Bad Data with Trim</h3> <p>If records have unintentional spaces in the entered strings the search function will need a wildcard on each side to find the data.<br>
To fix this issue the trim function can be utilised.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Artist <span class="token keyword">set</span> Name <span class="token operator">=</span> LTRIM<span class="token punctuation">(</span>Name<span class="token punctuation">)</span>
</code></pre></div><p>The Name field for all the artists is updated with whitespace removed from the left of the names.</p> <h3 id="fix-bad-data-with-rtrim-and-datalength"><a href="#fix-bad-data-with-rtrim-and-datalength" class="header-anchor">#</a> Fix Bad Data with RTrim and Datalength</h3> <ul><li>The LEN function will return the character length of a field not counting the whitespace characters.</li> <li>The DATALENGTH function can be used to get the full length of the string entered into the field including the whitespace.</li> <li>The RTRIM operation can be used to remove trailing whitespace from the string.</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> Name<span class="token punctuation">,</span> <span class="token function">LEN</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span>
<span class="token keyword">from</span> Artist
<span class="token keyword">where</span> DATALENGTH<span class="token punctuation">(</span>Name<span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> DATALENGTH<span class="token punctuation">(</span>RTRIM<span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>This query will find all the name records with extra whitespace at the end of the name &lt;&gt; means not equal to.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Artist <span class="token keyword">set</span> Name <span class="token operator">=</span> RTRIM<span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>Apply the fix.</p> <h2 id="working-with-dates"><a href="#working-with-dates" class="header-anchor">#</a> Working with Dates</h2> <h3 id="slicing-dates-with-datepart"><a href="#slicing-dates-with-datepart" class="header-anchor">#</a> Slicing Dates with Datepart</h3> <p>The DATEPART() function can be used to split dates by quarter, month, year and day.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total<span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span>quarter<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> quarter<span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span><span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">year</span><span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">day</span>
<span class="token keyword">from</span> Invoice<span class="token punctuation">;</span>
</code></pre></div><h3 id="doing-math-with-datediff"><a href="#doing-math-with-datediff" class="header-anchor">#</a> Doing Math with Datediff</h3> <p>DATEDIFF can be used to find the difference between the 2 dates.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> InvoiceId<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">,</span> Total<span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span>quarter<span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> quarter<span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span><span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">year</span><span class="token punctuation">,</span>
DATEPART<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">day</span><span class="token punctuation">,</span>
DATEDIFF<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span><span class="token string">'01/01/2005'</span><span class="token punctuation">,</span>InvoiceDate<span class="token punctuation">)</span> <span class="token keyword">as</span> MonthsInBusiness
<span class="token keyword">from</span> Invoice
<span class="token keyword">order</span> <span class="token keyword">by</span> MonthsInBusiness
</code></pre></div><p>This query orders all the invoice fields requested by the months the business has been trading from 01/01/2005 to the date of the invoice.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/code-snippets/snippets/dotNetSnippets.html" class="prev">
        .Net
      </a></span> <span class="next"><a href="/code-snippets/snippets/vueSnippets.html">
        Vue
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/code-snippets/assets/js/app.723004a5.js" defer></script><script src="/code-snippets/assets/js/2.602e7805.js" defer></script><script src="/code-snippets/assets/js/14.d4efdd0d.js" defer></script>
  </body>
</html>
